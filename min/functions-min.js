const inverseCoords=([a,b],c)=>a?b?a==c?[0,b]:[a,0]:[a,c]:[c,b],roundUp=a=>{const b=a.toString().split(".")[1];return b?5<=parseInt(b.split("")[0])?Math.round(a):a:a},generatePlayer=(a,b,c,d,f)=>{handleKeyPress=a=>handlePlayerMovement(a,c,d,b,f),playerCoord=a,ctx.fillStyle=c[a[0]][a[1]]&&b,ctx.fillRect(a[0],a[1],d,d),window.addEventListener("keypress",handleKeyPress)},generateEnemies=(a,b,c)=>{enemies=[],enemyCount=rng(a/2+2);for(let d=0;d<enemyCount;d++){const a=new Enemy(getEnemyStartCoordinate(b,c),~~(totalEnemyPower/enemyCount));enemies.push(a);const{coords:[d,e]}=a;COORDINATES[d][e].occupied=1,ctx.fillStyle=c[d][e]&&"#94040466",ctx.fillRect(d,e,TILE_WIDTH,TILE_HEIGHT)}player.checkFOV()},getEnemyStartCoordinate=(a,b)=>{const c=rng(NUMBER_OF_ROWS)*TILE_HEIGHT,d=rng(NUMBER_OF_ROWS)*TILE_HEIGHT;return 0!=c&&0!=d&&c!=a&&d!=a&&b[c]?.[d]?.walkable&&!b[c]?.[d]?.occupied?[c,d]:getEnemyStartCoordinate(a,b)},handlePlayerMovement=async(a,b,c,d,e)=>{if("KeyW"!=a.code&&"KeyD"!=a.code&&"KeyS"!=a.code&&"KeyA"!=a.code)return;let{key:f}=a;f=f.toLowerCase();let[g,h]=playerCoord;const[j,k]={w:[g,h-c],d:[g+c,h],s:[g,h+c],a:[g-c,h]}[f];b[j]?.[k].walkable&&!b[j]?.[k].occupied&&(console.log("you moved!"),enemies.length&&player.actionsLeft--,_actionsLeft.innerHTML=player.actionsLeft,ctx.clearRect(g,h,c,c),b[g][h].occupied=0,ctx.fillStyle=b[j][k].walkable&&d,ctx.fillRect(j,k,c,c),b[j][k].occupied=1,_steps.innerHTML=steps++,playerCoord=[j,k],!player.actionsLeft&&enemies.length&&(window.removeEventListener("keypress",handleKeyPress),setTimeout(()=>enemies.forEach((a,b)=>{let c=a.speed;const d=setInterval(()=>{a.handleTurn(e),c--,1>c&&(clearInterval(d),b==enemies.length-1&&window.addEventListener("keypress",handleKeyPress))},300)}),500),player.resetActions()));for(let f=0;f<e.length;f++)if(j==e[f][0]&&k==e[f][1])return window.removeEventListener("keypress",handleKeyPress),player.xp+=lvl,lvl++,enemyPowerMult(),0==lvl%10&&(player.xp+=100),player.checkIfNextLvl(),_expCurrent.textContent=player.xp,console.log("you win!"),player.resetActions(),buildDungeon(CANVAS_HEIGHT,CANVAS_WIDTH,COLUMNS,ROWS,TILE_HEIGHT,TILE_WIDTH,[e[f][0],e[f][1]]);player.checkFOV()},goFullScreen=()=>{body.requestFullscreen?body.requestFullscreen():body.mozRequestFullScreen?body.mozRequestFullScreen():body.webkitRequestFullscreen?body.webkitRequestFullscreen():body.msRequestFullscreen&&body.msRequestFullscreen()},generateRandomEndpoint=([c,d],a,b,e)=>{const f=0<e.length?[[c,d],...e.filter(([e,a])=>e!=c&&a!=d)]:[[c,d]],g=rng(a)*a,h=0==g||g==b?rng(a)*a:1<rng()?0:b,i=f.some(([a,c])=>(g==b||0==g)&&g==a||(h==b||0==h)&&h==c);return i?generateRandomEndpoint([c,d],a,b,f):[g,h]},dir=([a,b],c,d)=>{if(0==a)return 0<b?0:1;return 0==b?a<d+c?1:2:a==d?b<d+c?2:3:void 0};